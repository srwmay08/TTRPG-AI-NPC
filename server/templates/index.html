<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bugbear Banter GM Interface</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="app-container">
    <aside id="left-column">
        <div id="left-column-header">
            <h2>GM Controls</h2>
            
            <div id="pc-list-section-outer" class="collapsible-section"> 
                <h3 class="collapsible-header">Player Characters <span class="arrow-indicator">▼</span></h3>
                <div class="collapsible-content character-list">
                    <div id="active-pc-list"><p><em>Loading PCs...</em></p></div>
                </div>
            </div>
            
            <div class="tabs">
                <button class="tab-link active" onclick="openTab(event, 'tab-scene')">SCENE</button>
                <button class="tab-link" onclick="openTab(event, 'tab-npcs')">NPCS</button>
                <button class="tab-link" onclick="openTab(event, 'tab-lore')">LORE</button>
            </div>
        </div>

        <div id="left-column-content">
            <div id="tab-scene" class="tab-content active-tab">
                <h3>Scene Configuration</h3>
                <div id="scene-context-filters-container">
                    <label>Context Filter:</label>
                    <select id="scene-context-type-filter">
                        <option value="none">No Context Filter</option>
                        <option value="lore">Lore Entry</option>
                    </select>
                    <select id="scene-context-selector">
                        <option value="">-- Select Lore Entry --</option>
                    </select>
                </div>

                <div class="character-list-container">
                    <h4>NPCs in Scene</h4>
                    <div id="character-list-scene-tab" class="character-list">
                        <ul><li><em>Loading NPCs...</em></li></ul>
                    </div>
                </div>
            </div>

            <div id="tab-npcs" class="tab-content">
                <h3>All Characters</h3>
                <div class="character-list-container">
                    <div id="all-character-list-management" class="character-list">
                        <ul><li><em>Loading...</em></li></ul>
                    </div>
                </div>

                <hr>
                <h3>Create New Character</h3>
                <form id="create-character-form">
                    <input type="text" id="new-char-name" placeholder="Name" required>
                    <textarea id="new-char-description" placeholder="Description" rows="2" required></textarea>
                    <input type="text" id="new-char-personality" placeholder="Personality traits">
                    <select id="new-char-type">
                        <option value="NPC">NPC</option>
                        <option value="Player Character">Player Character</option>
                    </select>
                    <button type="submit">Create Character</button>
                </form>
            </div>

            <div id="tab-lore" class="tab-content">
                <div id="lore-detail-main-section" class="collapsible-section collapsed">
                    <h3 class="collapsible-header">
                        <span id="details-lore-name">No Lore Selected</span>
                        <span class="arrow-indicator">►</span>
                    </h3>
                    <div class="collapsible-content">
                        <p><strong>Type:</strong> <span id="details-lore-type"></span></p>
                        <div class="collapsible-section">
                            <h4 class="collapsible-header">GM Notes <span class="arrow-indicator">►</span></h4>
                            <div class="collapsible-content">
                                <textarea id="details-lore-gm-notes" rows="3"></textarea>
                                <button id="save-lore-gm-notes-btn">Save Notes</button>
                            </div>
                        </div>
                        <button id="delete-lore-btn" style="background-color: #dc3545;">Delete Entry</button>
                    </div>
                </div>

                <h3>All Lore Entries</h3>
                <div class="lore-entry-list-container">
                    <ul id="lore-entry-list"><li><em>Loading lore...</em></li></ul>
                </div>

                <hr>
                <h3>Create New Lore</h3>
                <form id="create-lore-entry-form">
                    <input type="text" id="new-lore-name" placeholder="Name" required>
                    <select id="new-lore-type"></select>
                    <textarea id="new-lore-description" placeholder="Description" rows="2"></textarea>
                    <textarea id="new-lore-key-facts" placeholder="Key facts (one per line)"></textarea>
                    <button type="submit">Create Lore</button>
                </form>
            </div>
        </div>
    </aside>

    <div id="resizer"></div>

    <main id="right-column">
        
        <div id="dialogue-interface" style="display: none;">
            <div id="active-participants-quick-view">
                <div id="pc-quick-view-section-in-scene"></div>
                <h2>Live Dialogue</h2>
                <div id="multi-npc-dialogue-container">
                    <p class="scene-event">Select NPCs from the SCENE tab to begin interaction.</p>
                </div>
            </div>

            <div id="dialogue-input-section">
                <h4>Player Input</h4>
                <div style="display: flex; gap: 10px;">
                    <select id="speaking-pc-select" style="flex: 1;">
                        <option value="">-- DM/Scene Event --</option>
                    </select>
                    <button id="generate-dialogue-btn" style="flex: 0 0 150px; margin-top:0;">Generate</button>
                </div>
                <textarea id="player-utterance" rows="3" placeholder="Player dialogue or scene description..."></textarea>
                
                <div id="ai-suggestions" style="display:none;"></div>
            </div>
        </div>

        <div id="pc-dashboard-view" style="display: none;">
            <h2>PC Dashboard</h2>
            <div id="pc-dashboard-content"></div> 
        </div>

        <div id="npc-profile-view" style="display: none;">
            </div>

        <div id="location-dashboard-view" style="display: none;">
            <h2>Location Dashboard</h2>
        </div>

    </main>
</div>

<script src="{{ url_for('static', filename='utils.js') }}"></script>
<script src="{{ url_for('static', filename='config.js') }}"></script>
<script src="{{ url_for('static', filename='dndCalculations.js') }}"></script>
<script src="{{ url_for('static', filename='appState.js') }}"></script>
<script src="{{ url_for('static', filename='apiService.js') }}"></script>

<script src="{{ url_for('static', filename='ui-widgets.js') }}"></script>
<script src="{{ url_for('static', filename='pc-renderers.js') }}"></script>
<script src="{{ url_for('static', filename='npc-renderers.js') }}"></script>
<script src="{{ url_for('static', filename='lore-renderers.js') }}"></script>

<script src="{{ url_for('static', filename='characterService.js') }}"></script>
<script src="{{ url_for('static', filename='main-view.js') }}"></script>
<script src="{{ url_for('static', filename='eventHandlers.js') }}"></script>
<script src="{{ url_for('static', filename='app.js') }}"></script>

</body>
</html>