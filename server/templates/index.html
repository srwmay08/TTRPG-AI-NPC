<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bugbear Banter GM Interface</title>
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>

    <div id="left-column" class="column">
        <div id="left-column-content">
            <h2>Characters & Details</h2>
            
            <div id="pc-list-section" class="collapsible-section">
                <h3>Player Characters</h3>
                <div class="collapsible-content character-list">
                    <div id="active-pc-list"><p><em>Loading PCs...</em></p></div>
                    {/* Speaking PC select moved to center column */}
                </div>
            </div>
            <div id="npc-list-section" class="collapsible-section">
                <h3>NPCs in Scene</h3>
                <div class="collapsible-content character-list">
                    <div id="character-list"><ul><li><em>Loading NPCs...</em></li></ul></div>
                </div>
            </div>

            <div id="character-profile-main-section" class="collapsible-section">
                <h3>Profile: <span id="details-char-name">None</span></h3>
                <div class="collapsible-content">
                    <div id="char-profile-display">
                        <p><strong>Type:</strong> <span id="profile-char-type"></span></p>
                        <p><strong>Description:</strong> <span id="profile-description"></span></p>
                        <p><strong>Personality:</strong> <span id="profile-personality"></span></p>
                    </div>

                    <div id="npc-faction-standings-section" class="collapsible-section">
                        <h4>NPC Standings Towards PCs</h4>
                        <div class="collapsible-content" id="npc-faction-standings-content">
                            {/* Content will be populated by script.js */}
                        </div>
                    </div>
                    
                    <div id="gm-notes-collapsible-section" class="collapsible-section">
                        <h3>GM Notes</h3>
                        <div class="collapsible-content">
                            <textarea id="gm-notes" rows="3" placeholder="Private notes for this character..."></textarea>
                            <button onclick="saveGMNotes()" id="save-gm-notes-btn" disabled>Save Notes</button>
                        </div>
                    </div>
                    <div id="npc-memories-collapsible-section" class="collapsible-section">
                        <h3>NPC Memories</h3>
                        <div class="collapsible-content" id="npc-specific-details-content">
                            <div id="add-memory-form">
                                <label for="new-memory-content">Add Custom Memory:</label>
                                <input type="text" id="new-memory-content" placeholder="Fact, event, observation...">
                                <input type="text" id="new-memory-type" placeholder="Type (e.g., fact, seen)">
                                <button onclick="addMemoryToCharacter()" id="add-memory-btn" disabled>Add Memory</button>
                            </div>
                            <div id="character-memories-list"></div>
                        </div>
                    </div>
                    <div id="character-history-collapsible-section" class="collapsible-section collapsed">
                        <h3>Character History</h3>
                        <div class="collapsible-content">
                            <label for="history-file-select">Available History Files to Add:</label>
                            <select id="history-file-select">
                                <option value="">-- Select a history file --</option>
                            </select>
                            <button onclick="associateHistoryFile()" id="associate-history-btn" disabled>Associate Selected History</button>
                            <h5>Currently Associated Files:</h5>
                            <ul id="associated-history-list"><li><em>None associated.</em></li></ul>
                            <h5>History Content:</h5>
                            <div id="history-content-display"><p><em>No history content loaded.</em></p></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="create-character-section" class="collapsible-section collapsed">
                <h3>Create New Character</h3>
                <div id="create-character-form" class="collapsible-content">
                    <label for="new-char-name">Name:</label>
                    <input type="text" id="new-char-name" required>
                    <label for="new-char-description">Description:</label>
                    <textarea id="new-char-description" rows="3" required></textarea>
                    <label for="new-char-personality">Personality (comma-separated):</label>
                    <input type="text" id="new-char-personality">
                    <label for="new-char-type">Character Type:</label>
                    <select id="new-char-type">
                        <option value="NPC" selected>NPC (Non-Player Character)</option>
                        <option value="PC">PC (Player Character)</option>
                    </select>
                    <button onclick="createCharacter()">Create Character</button>
                </div>
            </div>
        </div>
    </div>

    <div id="resizer"></div>

    <div id="center-column" class="column">
        <div id="dialogue-interface"> <h2>Scene Interaction</h2>
            
            <div id="pc-quick-view-section-in-scene" style="margin-bottom: 15px; display: none;"></div>
            <div id="scene-setup">
                <label for="scene-context">Dynamic Scene Context:</label>
                <textarea id="scene-context" rows="4" placeholder="Describe the current environment, mood, ongoing events..."></textarea>
                
                <label for="speaking-pc-select" style="margin-top: 10px;">Active Speaker/Event Origin:</label>
                <select id="speaking-pc-select" style="width: calc(100% - 16px); margin-bottom:5px;">
                    <option value="">-- DM/Scene Event --</option>
                </select>
            </div>
            <hr>
            <div id="multi-npc-dialogue-container">
                <p class="scene-event">Select NPCs to add them to the scene.</p>
            </div>
            <hr>
            <div id="dialogue-input-area">
                <label for="player-utterance">Player Says / Scene Event:</label>
                <textarea id="player-utterance" rows="2" placeholder="Enter player dialogue or describe a scene event..."></textarea>
                <button onclick="generateDialogue()" id="generate-dialogue-btn" disabled>Send to NPCs</button>
            </div>
            <div id="ai-suggestions" style="display:none;">
                <h4>AI Suggestions (Last Interaction):</h4>
                <div id="suggested-memories-list" class="ai-suggestion-category"><h6>Suggested Memories:</h6></div>
                <div id="suggested-topics-list" class="ai-suggestion-category"><h6>Suggested Follow-up Topics:</h6></div>
                <div id="suggested-npc-actions-list" class="ai-suggestion-category"><h5>Suggested NPC Actions/Thoughts:</h5></div>
                <div id="suggested-player-checks-list" class="ai-suggestion-category"><h5>Suggested Player Checks:</h5></div>
                <div id="suggested-faction-standing-changes" class="ai-suggestion-category"><h5>Suggested Faction Standing Change:</h5></div>
            </div>
        </div> 
        <div id="pc-dashboard-view">
            <h2>Player Character Dashboard</h2>
            <div id="pc-dashboard-content">
                <p class="pc-dashboard-no-selection">Select Player Characters from the left panel to view their details and comparisons.</p>
            </div>
        </div>
    </div>

    <script src="../static/config.js"></script>
    <script src="../static/utils.js"></script>
    <script src="../static/dndCalculations.js"></script>
    <script src="../static/apiService.js"></script>
    <script src="../static/appState.js"></script>
    <script src="../static/uiRenderers.js"></script> <script src="../static/characterService.js"></script>
    <script src="../static/eventHandlers.js"></script>
    <script src="../static/app.js"></script>
</body>
</html>